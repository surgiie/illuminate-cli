name: Format

on:
  push:
    branches:
      - "main"
    paths:
      - "app/**"
      - "tests/**"
      - "config/**"

jobs:
  format:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'
          coverage: none

      - name: Install composer dependencies
        run: composer install --prefer-dist --no-progress --ignore-platform-req=ext-curl

      - name: Format files with Laravel Pint
        run: composer format

      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: Apply formatting changes [skip actions]
          branch: ${{ github.head_ref }}
